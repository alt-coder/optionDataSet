# Option Data Processing and Analysis

This repository contains tools and scripts for processing and analyzing options trading data. It includes Python-based workflows for fetching, transforming, and storing historical options data, and a Go program for calculating option Greeks and handling missing data.

## Project Structure

```
.
├── .env            (Environment file for API credentials)
├── call/           (Contains raw or intermediate pickle files for Call options data)
├── dataset/        (Output directory for processed CSV data)
│   ├── YYYYMMDD/
│   │   ├── HHMM.csv
│   │   ├── ...
│   ├── ...
├── goGreek/        (Go program for calculating Greeks and data imputation)
│   ├── go.mod      (Go module file)
│   ├── go.sum      (Go checksum file)
│   ├── main.go     (Main Go program for processing data)
├── put/            (Contains raw or intermediate pickle files for Put options data)
├── ShoonyaApi-py/  (Likely the Shoonya API Python library)
├── test/           (Contains test data or scripts, including CSV files)
│   ├── YYYYMMDD/
│   │   ├── HHMM.csv
│   │   ├── ...
│   ├── ...
├── breeze_data.ipynb (Jupyter notebook for fetching data from Breeze API)
├── fetchData.ipynb (Jupyter notebook for Python data processing)
├── nifty_data.picke (Pickle file, likely containing Nifty index data)
├── optionChain.pkl (Output pickle file containing processed option chain data)
└── test.py         (Python script for generating dummy data)
```

-   [`call/`](call/): Directory intended for storing raw or intermediate Call options data, likely in pickle format.
-   [`dataset/`](dataset/): The primary output directory where processed options data is saved as CSV files, organized into subdirectories by date (`YYYYMMDD`) and named by time (`HHMM.csv`).
-   [`goGreek/`](goGreek/): Contains the Go program responsible for further processing the data in the `dataset/` directory.
    -   [`goGreek/main.go`](goGreek/main.go): The main Go source file.
    -   [`goGreek/go.mod`](goGreek/go.mod): Go module file listing dependencies.
    -   `goGreek/clients.csv`: A CSV file within the Go directory, its specific use is not clear from the provided code.
    -   `goGreek/processForPPO/`: A subdirectory, its purpose is not clear.
    -   `goGreek/regression/`: A subdirectory, its purpose is not clear.
-   [`put/`](put/): Directory intended for storing raw or intermediate Put options data, likely in pickle format.
-   [`ShoonyaApi-py/`](ShoonyaApi-py/): This directory is expected to contain the Python library necessary to interact with the Shoonya trading API, which is a potential source for the raw data.
-   [`test/`](test/): Contains existing CSV files structured by date and time, possibly used for testing the Go program or as sample data.
-   [`breeze_data.ipynb`](breeze_data.ipynb): A Jupyter notebook specifically designed for fetching historical options data using the Breeze API. It reads credentials from the `.env` file.
-   [`fetchData.ipynb`](fetchData.ipynb): A Jupyter notebook that handles the initial data loading from pickle files, merging Call and Put data, and saving it to CSV and a combined pickle file.
-   [`nifty_data.picke`](nifty_data.picke): A pickle file expected to contain historical data for the Nifty index, used as underlying price information during processing.
-   [`optionChain.pkl`](optionChain.pkl): An output file generated by `fetchData.ipynb`, containing the processed option chain data structure.
-   [`test.py`](test.py): A Python script for generating dummy options data, useful for testing the data processing workflows without real market data.
-   [`.env`](.env): Environment file used to store sensitive API credentials for the Breeze API.

## Data Format

The processed CSV files (`HHMM.csv`) in the `dataset/YYYYMMDD/` directories contain the following columns:

| Column Name          | Description                                                                 | Data Type |
| :------------------- | :-------------------------------------------------------------------------- | :-------- |
| `Strike Price`       | The strike price of the option.                                             | `float64` |
| `CALL_LTP`           | Last Traded Price for the Call option.                                      | `float64` |
| `PUT_LTP`            | Last Traded Price for the Put option.                                       | `float64` |
| `GAMMA_CALL`         | Gamma value for the Call option.                                            | `float64` |
| `GAMMA_PUT`          | Gamma value for the Put option.                                             | `float64` |
| `IV_CALL`            | Implied Volatility for the Call option.                                     | `float64` |
| `IV_PUT`             | Implied Volatility for the Put option.                                      | `float64` |
| `VOLUME_CALL`        | Trading volume for the Call option.                                         | `int`     |
| `VOLUME_PUT`         | Trading volume for the Put option.                                          | `int`     |
| `DELTA_CALL`         | Delta value for the Call option.                                            | `float64` |
| `DELTA_PUT`          | Delta value for the Put option.                                             | `float64` |
| `THETA_CALL`         | Theta value for the Call option.                                            | `float64` |
| `THETA_PUT`          | Theta value for the Put option.                                             | `float64` |
| `RHO_CALL`           | Rho value for the Call option.                                              | `float64` |
| `RHO_PUT`            | Rho value for the Put option.                                               | `float64` |
| `Underlying LTP`     | Last Traded Price of the underlying asset (e.g., Nifty).                    | `float64` |
| `CALL_OPEN_INTEREST` | Open Interest for the Call option.                                          | `int`     |
| `PUT_OPEN_INTEREST`  | Open Interest for the Put option.                                           | `int`     |
| `Days to Expiry`     | Number of days remaining until option expiry.                               | `float64` |
| `Vega_Call`          | Vega value for the Call option (calculated by the Go program).              | `float64` |
| `Vega_Put`           | Vega value for the Put option (calculated by the Go program).               | `float64` |

Note that some columns might have `NaN` values if the corresponding data was not available or applicable during processing. The Go program attempts to impute some of these missing values.

## Getting Started

### Breeze Data Fetching (`breeze_data.ipynb`)

1.  **Clone the repository:**
    ```bash
    git clone <repository_url>
    ```
2.  **Install Python dependencies:**
    This notebook requires `breeze-connect`, `pandas`, `numpy`, `tqdm`, `dill`, `scipy`, and `python-dotenv`. Install them using pip:
    ```bash
    pip install breeze-connect pandas numpy tqdm dill scipy python-dotenv
    ```
    Ensure the `ShoonyaApi-py` directory is present and contains the necessary library files if you plan to use the Shoonya API for data fetching (though this notebook focuses on Breeze).
3.  **Set up environment variables:**
    Create a [`.env`](.env) file in the root directory of the repository with your Breeze API credentials:
    ```dotenv
    BREEZE_API_KEY=your_api_key_here
    BREEZE_SECRET_KEY=your_secret_key_here
    BREEZE_CUSTOMER_ID=your_customer_id_here
    BREEZE_SESSION_TOKEN=your_session_token_here
    ```
    Replace the placeholder values with your actual credentials.
4.  **Run the Jupyter Notebook:**
    Open and run the [`breeze_data.ipynb`](breeze_data.ipynb) notebook using a Jupyter environment (like JupyterLab or VS Code's notebook support). The notebook will use the credentials from the [`.env`](.env) file to connect to the Breeze API and fetch historical data.

### Python Data Processing (`fetchData.ipynb`)

1.  **Ensure Python dependencies are installed:**
    As mentioned in the Breeze Data Fetching section, ensure you have `pandas`, `mibian`, `tqdm`, `numpy`, and `dill` installed.
2.  **Obtain raw data:**
    Place your raw Call and Put options data (presumably in pickle format, potentially fetched using `breeze_data.ipynb` or another method) into the `call/` and `put/` directories respectively. Ensure a `nifty_data.picke` file containing Nifty index data is also available in the root directory.
3.  **Run the Jupyter Notebook:**
    Open and run the [`fetchData.ipynb`](fetchData.ipynb) notebook using a Jupyter environment. The notebook will process the data and save the results to the `dataset/` directory and `optionChain.pkl`.

### Go Greek Calculation and Imputation (`goGreek/`)

1.  **Ensure Go is installed:**
    If you don't have Go installed, download and install it from [https://go.dev/dl/](https://go.dev/dl/).
2.  **Navigate to the `goGreek` directory:**
    ```bash
    cd goGreek
    ```
3.  **Download Go dependencies:**
    The project uses `github.com/gocarina/gocsv` and `github.com/jasonmerecki/gopriceoptions`. These should be listed in `go.mod`. Download them using:
    ```bash
    go mod download
    ```
4.  **Place processed CSV data:**
    Ensure the `dataset/` directory (relative to the repository root, i.e., `../dataset` from the `goGreek` directory) contains the CSV files generated by the Python notebook (`fetchData.ipynb`).
5.  **Run the Go program:**
    ```bash
    go run main.go
    ```
    This program will read the CSV files from `dataset/`, calculate Greeks, attempt to impute missing values, and overwrite the original CSV files with the updated data. It also includes a routine to delete data directories if they have too many missing values or zero underlying LTP.

## Functionality

### Breeze Data Fetching (`breeze_data.ipynb`)

-   Connects to the Breeze API using credentials loaded from the [`.env`](.env) file.
-   Provides functions to fetch historical options data for specified parameters (interval, date range, stock code, exchange, product type, right, strike price).
-   Includes logic to handle date ranges and expiry dates.
-   Saves fetched data to pickle files.

### Python Data Processing (`fetchData.ipynb`)

-   Loads raw Call and Put options data from pickle files.
-   Loads Nifty index data.
-   Merges and processes Call and Put data based on strike price and datetime.
-   Calculates 'Days to Expiry'.
-   Stores data in a `defaultdict` of pandas DataFrames, indexed by datetime.
-   Saves the processed data to structured CSV files in the `dataset/` directory.
-   Saves the complete processed data structure to `optionChain.pkl`.

### Go Greek Calculation and Imputation (`goGreek/main.go`)

-   Reads CSV files from the `dataset/` directory.
-   Parses the CSV data into a Go struct (`OptionData`).
-   Calculates option Greeks (Delta, Gamma, Theta, Vega, Rho) using the `gopriceoptions` library.
-   Imputes missing (NaN) values for certain fields by averaging the values from the previous and next strike prices, specifically for options within a range of 300 points around the underlying LTP.
-   Sorts the option data by strike price.
-   Overwrites the original CSV files in the `dataset/` directory with the updated data including calculated Greeks and imputed values.
-   Includes a routine to delete directories from `dataset/` if a file within that directory has more than 5 fields with NaN values or if the underlying LTP is zero.

## Dependencies

-   **Python:**
    -   `breeze-connect`
    -   `pandas`
    -   `mibian`
    -   `tqdm`
    -   `numpy`
    -   `dill`
    -   `scipy` (required by `mibian`)
    -   `python-dotenv`
-   **Go:**
    -   `github.com/gocarina/gocsv`
    -   `github.com/jasonmerecki/gopriceoptions`
    -   `gonum.org/v1/gonum` (indirectly required by `gopriceoptions`)

## Contributing

(Add contributing guidelines here if applicable)

## License

(Add license information here if applicable)